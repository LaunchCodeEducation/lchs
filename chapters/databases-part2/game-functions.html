<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>25.9. Gameplay Functions Review (Optional) &#8212; LaunchCode&#39;s LCHS  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Index" href="../../genindex.html" />
    <link rel="prev" title="25.8. Next Steps" href="extras.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
   <div class="container">
     <div class="navbar-header">
       <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </button>
       <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
       </a>
       <span class="navbar-text navbar-version pull-left"><b></b></span>
     </div>

       <div class="collapse navbar-collapse nav-collapse">
         <ul class="nav navbar-nav">
           
           
             
           
           
           
           
           
         </ul>

         
           
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
         
       </div>
   </div>
 </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html"><span class="section-number">25. </span>Build a Minesweeper Game</a></li>
    <li class="active"><span class="section-number">25.9. </span>Gameplay Functions Review (Optional)</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content " role="main">

    
  <div class="section" id="gameplay-functions-review-optional">
<h1><span class="section-number">25.9. </span>Gameplay Functions Review (Optional)<a class="headerlink" href="#gameplay-functions-review-optional" title="Permalink to this headline">¶</a></h1>
<p>When you first cloned the Minesweeper project from GitHub, the repository
included several complete functions. The video tutorials in the chapter mention
these functions, but they skip a detailed analysis of the code. Well, now is a
good time to take a deeper look!</p>
<p>This page describes how the ready-made functions work. However, the code shows
ONE way to solve the gameplay tasks. There are many OTHER ways to achieve the
same results. Feel free to create a new branch in your Git repository and
experiment with your own ideas. You can try to streamline the functions, or
replace any of them with a completely new set of statements. Remember, we learn
to code by <em>coding</em>, and this includes examining other programmers’ work.</p>
<div class="section" id="the-game-logic-py-module">
<h2><span class="section-number">25.9.1. </span>The <code class="docutils literal notranslate"><span class="pre">game_logic.py</span></code> Module<a class="headerlink" href="#the-game-logic-py-module" title="Permalink to this headline">¶</a></h2>
<p>This file manages the nitty-gritty details of running Minesweeper. It resets
the conditions for each new game, initializes session variables, populates
lists, hides mines, formats SQL query strings, and checks if the player makes a
safe choice on the board.</p>
<p>The module begins by importing three <em>other</em> Python modules:</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">crud</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">random</span></code> is used to choose where to hide the mines. <code class="docutils literal notranslate"><span class="pre">string</span></code> helps build
the row labels and cell coordinates. The functions from <code class="docutils literal notranslate"><span class="pre">crud</span></code> run the SQL
queries.</p>
<p>Now let’s examine four of the functions included in <code class="docutils literal notranslate"><span class="pre">game_logic.py</span></code>.</p>
<div class="section" id="the-make-columns-function">
<h3><span class="section-number">25.9.1.1. </span>The <code class="docutils literal notranslate"><span class="pre">make_columns()</span></code> Function<a class="headerlink" href="#the-make-columns-function" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">make_columns()</span></code> is the shortest function in the module. It’s job is to
fill a list with the column headings for the game board. It is called from the
<code class="docutils literal notranslate"><span class="pre">reset_board()</span></code> function.</p>
<div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/col-headings.png"><img alt="The 11 column headings on the game board. The first is blank, followed by numbers 1 - 10." src="../../_images/col-headings.png" style="width: 70%;" /></a>
<p class="caption"><span class="caption-text">The game board has 11 columns, numbered 1 - 10. The first column doesn’t
contain a heading.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_columns</span><span class="p">():</span>
   <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">headings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">headings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Here’s a breakdown of the code:</p>
<ol class="arabic simple">
<li><p><strong>Line 21</strong>: Instead of an empty list, <code class="docutils literal notranslate"><span class="pre">headings</span></code> begins with a single
entry. That string value keeps the upper left cell on the board blank. Since
the first column contains row letters instead of active spaces, no heading
is necessary.</p></li>
<li><p><strong>Line 22</strong>: This sets up a basic <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Each time it repeats,
<code class="docutils literal notranslate"><span class="pre">label</span></code> is assigned a new integer (0, 1, 2, … 9).</p></li>
<li><p><strong>Line 23</strong>: This appends the value <code class="docutils literal notranslate"><span class="pre">label</span> <span class="pre">+</span> <span class="pre">1</span></code> to the end of the
<code class="docutils literal notranslate"><span class="pre">headings</span></code> list.</p></li>
<li><p><strong>Line 24</strong>: This returns an independent copy of the column headings, which
is assigned to <code class="docutils literal notranslate"><span class="pre">session['columns']</span></code>.</p></li>
</ol>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>Since the loop just builds a list of 10 numbers, you might wonder why we
don’t hard-code the result.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">headings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Using a loop keeps our code flexible. If we add a parameter to
<code class="docutils literal notranslate"><span class="pre">make_columns()</span></code>, we can adapt the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop to generate a different
number of headings. This opens up the possibility for other board layouts.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_columns</span><span class="p">(</span><span class="n">num_headings</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
   <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_headings</span><span class="p">):</span>
      <span class="n">headings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">headings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-make-rows-function">
<h3><span class="section-number">25.9.1.2. </span>The <code class="docutils literal notranslate"><span class="pre">make_rows()</span></code> Function<a class="headerlink" href="#the-make-rows-function" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">make_rows()</span></code> is also called from the <code class="docutils literal notranslate"><span class="pre">reset_board()</span></code> function. Its job is
to build a list with all the string values needed for the row labels and button
text.</p>
<p>There are 10 rows on the game board (A - J), and each one contains 11 columns.
To fit this structure, <code class="docutils literal notranslate"><span class="pre">make_rows()</span></code> returns a two-dimensional
<em>list of lists</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">rows</span> <span class="o">=</span> <span class="o">[</span> <span class="o">[</span>row_A_entries<span class="o">]</span>, <span class="o">[</span>row_B_entries<span class="o">]</span>, ... <span class="o">[</span>row_J_entries<span class="o">]</span> <span class="o">]</span>
</pre></div>
</div>
<p>Each entry in <code class="docutils literal notranslate"><span class="pre">rows</span></code> is a list with 11 elements. Each element is the string
value for a row label (<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">-</span> <span class="pre">J</span></code>) or button text (like <code class="docutils literal notranslate"><span class="pre">B7</span></code>).</p>
<p>To generate the 2-dimensional list, <code class="docutils literal notranslate"><span class="pre">make_rows()</span></code> uses a pair of nested
loops.</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_rows</span><span class="p">():</span>
   <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">letter</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
      <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">letter</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
      <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</td></tr></table></div>
<p>Here’s a breakdown of the code:</p>
<ol class="arabic">
<li><p><strong>Line 27</strong>: Assigns an empty list to <code class="docutils literal notranslate"><span class="pre">rows</span></code>.</p></li>
<li><p><strong>Lines 28 - 30</strong>: Line 28 starts the <em>outer loop</em>. Each time it repeats,
<code class="docutils literal notranslate"><span class="pre">row</span></code> is assigned a new value in the range 0 - 9. Line 29 uses this
integer to assign an uppercase character (<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">-</span> <span class="pre">J</span></code>) to <code class="docutils literal notranslate"><span class="pre">letter</span></code>. Line 30
assigns an empty list to the accumulator variable <code class="docutils literal notranslate"><span class="pre">cells</span></code>.</p></li>
<li><p><strong>Lines 31 - 35</strong>: Line 31 begins the <em>inner loop</em>. Each time it repeats,
<code class="docutils literal notranslate"><span class="pre">column</span></code> is assigned an integer in the range 0 - 10. When <code class="docutils literal notranslate"><span class="pre">column</span> <span class="pre">==</span> <span class="pre">0</span></code>,
we are dealing with the first cell in the row. Line 33 appends <code class="docutils literal notranslate"><span class="pre">letter</span></code> to
<code class="docutils literal notranslate"><span class="pre">cells</span></code>.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">column</span></code> is not <code class="docutils literal notranslate"><span class="pre">0</span></code>, the space on the board will contain a button.
Line 35 appends a letter/number combination to <code class="docutils literal notranslate"><span class="pre">cells</span></code>. This string will
be used as the text inside the button.</p>
<p>After the inner loop finishes, the <code class="docutils literal notranslate"><span class="pre">cells</span></code> list contains 11 entries.</p>
</li>
<li><p><strong>Line 36</strong>: This statement is part of the outer loop. It appends the
completed <code class="docutils literal notranslate"><span class="pre">cells</span></code> list to <code class="docutils literal notranslate"><span class="pre">rows</span></code>.</p></li>
<li><p><strong>Line 37</strong>: This returns the completed <code class="docutils literal notranslate"><span class="pre">rows</span></code> list, which is assigned to
<code class="docutils literal notranslate"><span class="pre">session['rows']</span></code>.</p></li>
</ol>
</div>
<div class="section" id="the-place-mines-function">
<h3><span class="section-number">25.9.1.3. </span>The <code class="docutils literal notranslate"><span class="pre">place_mines()</span></code> Function<a class="headerlink" href="#the-place-mines-function" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">place_mines()</span></code> is called from the <code class="docutils literal notranslate"><span class="pre">index()</span></code> function in <code class="docutils literal notranslate"><span class="pre">main.py</span></code>. Its
job is to randomly assign mines to locations on the game board. It accepts a
single parameter, which is the number of mines to hide.</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">place_mines</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
   <span class="n">mines</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">mines</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">:</span>
      <span class="n">row</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
      <span class="n">column</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
      <span class="n">location</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mines</span><span class="p">:</span>
         <span class="n">mines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
   <span class="n">mines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
   <span class="n">record_mines</span><span class="p">(</span><span class="n">mines</span><span class="p">)</span>
   <span class="n">count_mines</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">mines</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Here’s a breakdown of the code:</p>
<ol class="arabic">
<li><p><strong>Line 40</strong>: Assigns an empty list to the <code class="docutils literal notranslate"><span class="pre">mines</span></code> variable. This begins
yet another example of the accumulator pattern!</p></li>
<li><p><strong>Line 41</strong>: The condition <code class="docutils literal notranslate"><span class="pre">len(mines)</span> <span class="pre">&lt;</span> <span class="pre">amount</span></code> keeps the <code class="docutils literal notranslate"><span class="pre">while</span></code> loop
running until the number of entries in <code class="docutils literal notranslate"><span class="pre">mines</span></code> matches the number assigned
to <code class="docutils literal notranslate"><span class="pre">amount</span></code>.</p></li>
<li><p><strong>Line 42</strong>: <code class="docutils literal notranslate"><span class="pre">string.ascii_uppercase[0:10]</span></code> returns a slice from the
string of uppercase letters. In this case, the index values <code class="docutils literal notranslate"><span class="pre">[0:10]</span></code>
return the letters <code class="docutils literal notranslate"><span class="pre">'ABCDEFGHIJ'</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">random.choice</span></code> then selects one letter from the slice.</p>
</li>
<li><p><strong>Line 43</strong>: This selects a random integer from 1 - 10, including both end
points.</p></li>
<li><p><strong>Line 44</strong>: This combines the row letter with the column number and assigns
the string to <code class="docutils literal notranslate"><span class="pre">location</span></code>.</p></li>
<li><p><strong>Lines 45 &amp; 46</strong>: The conditional prevents duplicate choices for the mine
locations. If the newly chosen cell is NOT currently in the <code class="docutils literal notranslate"><span class="pre">mines</span></code> list,
it is added. Otherwise, the choice is ignored.</p></li>
<li><p><strong>Lines 47 - 50</strong>: These statements alphabetize the <code class="docutils literal notranslate"><span class="pre">mines</span></code> list, call two
of the <code class="docutils literal notranslate"><span class="pre">crud.py</span></code> functions, and return an independent copy of the list.</p></li>
</ol>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>We coded the <code class="docutils literal notranslate"><span class="pre">record_mines()</span></code> and <code class="docutils literal notranslate"><span class="pre">count_mines()</span></code> functions on the
<a class="reference internal" href="db-logic.html#crud-tutorials"><span class="std std-ref">Database Functions page</span></a>.</p>
</div>
</div>
<div class="section" id="the-check-guess-function">
<h3><span class="section-number">25.9.1.4. </span>The <code class="docutils literal notranslate"><span class="pre">check_guess()</span></code> Function<a class="headerlink" href="#the-check-guess-function" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">check_guess()</span></code> is called from the <code class="docutils literal notranslate"><span class="pre">play()</span></code> function in <code class="docutils literal notranslate"><span class="pre">main.py</span></code>. It
returns <code class="docutils literal notranslate"><span class="pre">True</span></code> each time the player chooses a safe cell on the game board.
This happens when the cell does NOT contain a mine, or if the user selects the
<em>Flag Mine</em> option before clicking on the space. <code class="docutils literal notranslate"><span class="pre">check_guess()</span></code> returns
<code class="docutils literal notranslate"><span class="pre">False</span></code> when the player hits a mine.</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_guess</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
   <span class="n">safe_guess</span> <span class="o">=</span> <span class="kc">True</span>
   <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
      <span class="n">session</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
      <span class="n">session</span><span class="p">[</span><span class="s1">&#39;num_mines&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">guess</span> <span class="ow">in</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;mines&#39;</span><span class="p">]:</span>
         <span class="n">session</span><span class="p">[</span><span class="s1">&#39;mines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">sql_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM board WHERE coordinates = &#39;</span><span class="si">{</span><span class="n">guess</span><span class="si">}</span><span class="s2">&#39; AND mine_id IS NULL&quot;</span>
      <span class="n">no_mine</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">no_mine</span><span class="p">:</span>
         <span class="n">session</span><span class="p">[</span><span class="s1">&#39;guesses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">guess</span> <span class="ow">in</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]:</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;num_mines&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">safe_guess</span> <span class="o">=</span> <span class="kc">False</span>
   <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
   <span class="n">sql_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;UPDATE board SET guessed = True WHERE coordinates = &#39;</span><span class="si">{</span><span class="n">guess</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
   <span class="n">execute_query</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">safe_guess</span>
</pre></div>
</td></tr></table></div>
<p>Given the size of the function, it’s easier to review it with a video!</p>
<section class="vid_box">
   <iframe class="vid" src="https://www.youtube-nocookie.com/embed/MlSs38HWk2I" frameborder="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section></div>
</div>
<div class="section" id="the-crud-py-module">
<span id="check-surroundings-walkthrough"></span><h2><span class="section-number">25.9.2. </span>The <code class="docutils literal notranslate"><span class="pre">crud.py</span></code> Module<a class="headerlink" href="#the-crud-py-module" title="Permalink to this headline">¶</a></h2>
<p>This file manages the nitty-gritty details of interacting with the game’s
database. We reviewed or coded all but one of these functions earlier in this
chapter. Now it’s time to complete that work.</p>
<div class="section" id="the-check-surroundings-function">
<h3><span class="section-number">25.9.2.1. </span>The <code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code> Function<a class="headerlink" href="#the-check-surroundings-function" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code> is called at the start of each new round of
Minesweeper. When the player submits a number of mines to hide:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">index()</span></code> function calls <code class="docutils literal notranslate"><span class="pre">place_mines()</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">place_mines()</span></code> function picks random locations on the board to hide
the new set of mines. Then it calls the <code class="docutils literal notranslate"><span class="pre">count_mines()</span></code> function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count_mines()</span></code> iterates through all of the cells in the <code class="docutils literal notranslate"><span class="pre">board</span></code> table,
and it passes each location to <code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code>.</p></li>
</ol>
<p>For a given cell on the table, <code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code> counts the number of
mines hidden in the surrounding spaces. This total is stored in both the
session cookie and the database.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code> is probably the most involved. To help
break up the discussion, we’ve split the explanation into two parts. The first
describes how to perform a <em>2-dimensional search</em>, which checks the 8 cells
above, below, and to each side of the selected location. The second video
examines the Python code used to perform that search.</p>
<div class="figure align-default" id="id2">
<a class="reference internal image-reference" href="../../_images/2d-search.png"><img alt="Showing the difference between a 1-dimensional and 2-dimensional search." src="../../_images/2d-search.png" style="width: 70%;" /></a>
<p class="caption"><span class="caption-text">A 2-dimensional search involves changing the row AND column values.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="how-to-check-surrounding-cells">
<h3><span class="section-number">25.9.2.2. </span>How to Check Surrounding Cells<a class="headerlink" href="#how-to-check-surrounding-cells" title="Permalink to this headline">¶</a></h3>
<section class="vid_box">
   <iframe class="vid" src="https://www.youtube-nocookie.com/embed/4_EU4nwMdRs" frameborder="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section></div>
<div class="section" id="the-check-surroundings-code">
<h3><span class="section-number">25.9.2.3. </span>The <code class="docutils literal notranslate"><span class="pre">check_surroundings()</span></code> Code<a class="headerlink" href="#the-check-surroundings-code" title="Permalink to this headline">¶</a></h3>
<section class="vid_box">
   <iframe class="vid" src="https://www.youtube-nocookie.com/embed/t10yxhZNar8" frameborder="1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section></div>
<div class="section" id="video-summary">
<h3><span class="section-number">25.9.2.4. </span>Video Summary<a class="headerlink" href="#video-summary" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>To check all of the spaces surrounding a given cell, we can use a pair of
<a class="reference internal" href="../loops/project.html#nested-loops"><span class="std std-ref">nested for loops</span></a>. The <em>outer loop</em> sets a new row
value. The <em>inner loop</em> iterates over the possible columns in each row.</p></li>
<li><p>To simplify our search algorithm, add extra cells to the board!</p>
<ol class="loweralpha simple">
<li><p>Place the cells along the outer edge of the game board.</p></li>
<li><p>The cells remain hidden from the player, and they will never contain a
mine.</p></li>
<li><p>The cost of storing data for the hidden cells is well worth it. We gain
<em>a lot more</em> by decreasing the complexity of the search.</p></li>
</ol>
</li>
</ol>
</div>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="extras.html"><span aria-hidden="true">&larr;</span> <span class="section-number">25.8. </span>Next Steps</a></li>
        
        
        <li class="next"><a href="../../genindex.html">Index <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/databases-part2/game-functions.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>