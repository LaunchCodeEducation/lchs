<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>23.6. Try It! Flask Sessions (Part 2) &#8212; LaunchCode&#39;s LCHS  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="23.7. Exercises: Flask Sessions" href="exercises.html" />
    <link rel="prev" title="23.5. Try It! Flask Sessions" href="try-it-sessions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
   <div class="container">
     <div class="navbar-header">
       <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </button>
       <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
       </a>
       <span class="navbar-text navbar-version pull-left"><b></b></span>
     </div>

       <div class="collapse navbar-collapse nav-collapse">
         <ul class="nav navbar-nav">
           
           
             
           
           
           
           
           
         </ul>

         
           
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
         
       </div>
   </div>
 </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html"><span class="section-number">23. </span>Cookies &amp; Sessions</a></li>
    <li class="active"><span class="section-number">23.6. </span>Try It! Flask Sessions (Part 2)</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content " role="main">

    
  <div class="section" id="try-it-flask-sessions-part-2">
<h1><span class="section-number">23.6. </span>Try It! Flask Sessions (Part 2)<a class="headerlink" href="#try-it-flask-sessions-part-2" title="Permalink to this headline">¶</a></h1>
<p>Now that we can set and access a Flask session, let’s collect entries from the
form and add the items to our list.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>In the code blocks below, the generic <code class="docutils literal notranslate"><span class="pre">list_name</span></code> has been replaced with
<code class="docutils literal notranslate"><span class="pre">groceries</span></code>. Feel free to use a different variable name to better describe
the elements in your own list.</p>
</div>
<div class="section" id="add-form-entries-to-list">
<h2><span class="section-number">23.6.1. </span>Add Form Entries to List<a class="headerlink" href="#add-form-entries-to-list" title="Permalink to this headline">¶</a></h2>
<p>The HTML code for the form is complete. However, there is currently no code in
<code class="docutils literal notranslate"><span class="pre">main.py</span></code> to handle form submissions. Let’s fix that.</p>
<p>Return to <code class="docutils literal notranslate"><span class="pre">main.py</span></code>, and replace the <code class="docutils literal notranslate"><span class="pre">pass</span></code> keyword in line 10 with this
block of 4 statements:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
   <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
      <span class="n">new_item</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;new_item&#39;</span><span class="p">]</span>
      <span class="n">current_list</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span>
      <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
      <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_list</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</td></tr></table></div>
<p><strong>Code breakdown</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Line 10</strong>: Requests the entry submitted from the web form and assigns the
string to <code class="docutils literal notranslate"><span class="pre">new_item</span></code>.</p></li>
<li><p><strong>Line 11</strong>: Retrieves the <code class="docutils literal notranslate"><span class="pre">groceries</span></code> list stored in <code class="docutils literal notranslate"><span class="pre">session</span></code> and
assigns it to <code class="docutils literal notranslate"><span class="pre">current_list</span></code>.</p></li>
<li><p><strong>Line 12</strong>: Appends <code class="docutils literal notranslate"><span class="pre">new_item</span></code> to the end of <code class="docutils literal notranslate"><span class="pre">current_list</span></code>.</p></li>
<li><p><strong>Line 13</strong>: Reassigns <code class="docutils literal notranslate"><span class="pre">current_list</span></code> to the session.</p></li>
</ol>
<p>Since <code class="docutils literal notranslate"><span class="pre">groceries</span></code> is already a key in <code class="docutils literal notranslate"><span class="pre">session</span></code>, line 13 replaces its old
value with the updated list.</p>
<p>Save the changes, then reload the webpage. Try submitting a few new items from
the form. You should see each entry appear on the page after you click the
<em>Add Item</em> button.</p>
<div class="section" id="avoid-duplicate-entries">
<h3><span class="section-number">23.6.1.1. </span>Avoid Duplicate Entries<a class="headerlink" href="#avoid-duplicate-entries" title="Permalink to this headline">¶</a></h3>
<p>As written, the Python code allows users to add the same item to the list
multiple times. While this behavior isn’t wrong, it doesn’t fit with the idea
of a grocery list.</p>
<p>Modify your code to prevent repeats from happening.</p>
<ol class="arabic">
<li><p>Add a conditional to check if <code class="docutils literal notranslate"><span class="pre">new_item</span></code> is already present in
<code class="docutils literal notranslate"><span class="pre">current_list</span></code>. If so, don’t add it again. If not, append it to the list.</p></li>
<li><p>To prevent issues with case (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;Apples&quot;</span></code> vs. <code class="docutils literal notranslate"><span class="pre">&quot;apples&quot;</span></code>), add a
string method to the form request on line 10. <code class="docutils literal notranslate"><span class="pre">.lower()</span></code>, <code class="docutils literal notranslate"><span class="pre">.upper()</span></code>,
<code class="docutils literal notranslate"><span class="pre">.capitalize()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.title()</span></code> all work well.</p></li>
<li><p>Your code will look something like this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">new_item</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;new_item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>  <span class="c1"># Standardize case for form entries.</span>
<span class="n">current_list</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">new_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_list</span><span class="p">:</span>          <span class="c1"># Check if new_item is actually new.</span>
   <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
<span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_list</span>       <span class="c1"># Update the session value.</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>Save your changes, then test your application.</p></li>
</ol>
</div>
<div class="section" id="fix-the-logic-error">
<h3><span class="section-number">23.6.1.2. </span>Fix the Logic Error<a class="headerlink" href="#fix-the-logic-error" title="Permalink to this headline">¶</a></h3>
<p>When the browser sends a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to the Flask server, the <code class="docutils literal notranslate"><span class="pre">index()</span></code>
function saves an empty list to the <code class="docutils literal notranslate"><span class="pre">session</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>While this is fine the first time we visit the page, it doesn’t help if we have
existing data.</p>
<div class="admonition-try-it admonition">
<p class="admonition-title"><i class="fas fa-puzzle-piece" aria-hidden="true"></i>Try It!</p>
<p>In the application tab, click in the address bar and tap <em>Enter</em>. This sends
a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to the server. Notice that any list items displayed on the
page disappear!</p>
</div>
<p>If our list already contains data, we want to keep those elements after a
<code class="docutils literal notranslate"><span class="pre">GET</span></code> or <code class="docutils literal notranslate"><span class="pre">POST</span></code> request.</p>
<p>Before assigning an empty list to the <code class="docutils literal notranslate"><span class="pre">groceries</span></code> key, we need to check to
see if it already exists in <code class="docutils literal notranslate"><span class="pre">session</span></code>. If <code class="docutils literal notranslate"><span class="pre">groceries</span></code> is NOT part of the
session yet, then we should add it and assign the empty list. If <code class="docutils literal notranslate"><span class="pre">groceries</span></code>
is currently a key in <code class="docutils literal notranslate"><span class="pre">session</span></code>, then we keep it as-is.</p>
<ol class="arabic">
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">else</span></code> clause in the <code class="docutils literal notranslate"><span class="pre">index()</span></code> function as follows:</p>
<div class="highlight-Python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
   <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
      <span class="n">new_item</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;new_item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
      <span class="n">current_list</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">new_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_list</span><span class="p">:</span>
         <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
      <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_list</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="s1">&#39;groceries&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
         <span class="n">session</span><span class="p">[</span><span class="s1">&#39;groceries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>When the browser sends a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request, the <code class="docutils literal notranslate"><span class="pre">else</span></code> clause runs.</p>
<ol class="loweralpha simple">
<li><p>Line 16 checks if the <code class="docutils literal notranslate"><span class="pre">groceries</span></code> key does NOT exist in the <code class="docutils literal notranslate"><span class="pre">session</span></code>
object.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the program creates the <code class="docutils literal notranslate"><span class="pre">groceries</span></code> key and assigns
it an empty list.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the code makes no changes to the existing data.</p></li>
</ol>
</li>
<li><p>Test your program by adding a few items to the list. Then try:</p>
<ol class="loweralpha simple">
<li><p>Loading the page from the address bar.</p></li>
<li><p>Opening the application in a new tab.</p></li>
<li><p>Stopping and restarting <code class="docutils literal notranslate"><span class="pre">main.py</span></code>.</p></li>
</ol>
<p>In each case, the contents of your list should persist.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="delete-session-data">
<h2><span class="section-number">23.6.2. </span>Delete Session Data<a class="headerlink" href="#delete-session-data" title="Permalink to this headline">¶</a></h2>
<p>So far, we’ve used the browser tools to remove a session cookie. While this
works well for visitors to our website, it’s not an option for us as the
programmers. Since session files are stored on a user’s device, they decide how
to manage them. Well behaved coders do NOT delete files on someone else’s
computer!</p>
<p>While we cannot remove a session file, we can clear some or all of the data
stored in it. There two methods we can use to remove data from a session.</p>
<ol class="arabic">
<li><p>To remove ALL key/value pairs from a session, the syntax is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>To remove a single key/value pair from a session, the syntax is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Without the <code class="docutils literal notranslate"><span class="pre">None</span></code> argument, <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> throws an error if <code class="docutils literal notranslate"><span class="pre">key</span></code> does
not exist in the session. We could use anything in place of <code class="docutils literal notranslate"><span class="pre">None</span></code>, like
<code class="docutils literal notranslate"><span class="pre">5</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;Hello,</span> <span class="pre">World!&quot;</span></code>. However, <code class="docutils literal notranslate"><span class="pre">None</span></code> represents an empty value,
so it makes sense for a missing key.</p>
<p>Including <code class="docutils literal notranslate"><span class="pre">None</span></code> sets it as a default value. If <code class="docutils literal notranslate"><span class="pre">key</span></code> is missing, then
<code class="docutils literal notranslate"><span class="pre">.pop()</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code> as its result, and our program keeps running.</p>
</li>
</ol>
<div class="section" id="remove-a-specific-value">
<h3><span class="section-number">23.6.2.1. </span>Remove a Specific Value<a class="headerlink" href="#remove-a-specific-value" title="Permalink to this headline">¶</a></h3>
<p>Since the session in our demo application stores only one key/value pair, using
<code class="docutils literal notranslate"><span class="pre">.clear()</span></code> and <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> produce the same result.</p>
<p>What if we want to remove only one item from the stored list instead of the
entire collection? For that, we need to do a little more work. Right now, if
<code class="docutils literal notranslate"><span class="pre">new_item</span></code> is NOT part of the list, it gets added to the collection.
Otherwise, nothing happens.</p>
<p>Let’s update the conditional on line 12 to either add a new item to the list or
delete an existing element.</p>
<ol class="arabic">
<li><p>Add an <code class="docutils literal notranslate"><span class="pre">else</span></code> clause to delete an entry from the list. If the user submits
an item that already exists, it is removed from the collection.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">new_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_list</span><span class="p">:</span>
   <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="n">current_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>Test your code by adding then removing several items. Be sure to check that
the form submissions are case-insensitive.</p></li>
</ol>
<p>When done, your application should behave something like this:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/grocery-list.gif"><img alt="GIF showing the addition and deletion of items from a stored list." src="../../_images/grocery-list.gif" style="width: 40%;" /></a>
</div>
</div>
</div>
<div class="section" id="final-touches-optional">
<h2><span class="section-number">23.6.3. </span>Final Touches (Optional)<a class="headerlink" href="#final-touches-optional" title="Permalink to this headline">¶</a></h2>
<p>Your Flask app now allows you to add and remove items. However, there are a few
extra features that will improve the user experience and make your project more
polished.</p>
<p>These tasks don’t teach you anything new about sessions, but they do provide a
good review of older skills.</p>
<ol class="arabic">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">.sort()</span></code> method to alphabetize your list. Experiment with using
<code class="docutils literal notranslate"><span class="pre">session['groceries'].sort()</span></code> vs. <code class="docutils literal notranslate"><span class="pre">current_list.sort()</span></code>. Is there a
difference?</p></li>
<li><p>Use CSS to make the page look nice.</p></li>
<li><p>After an item is added to the list, display a message for the user.
Something like, <code class="docutils literal notranslate"><span class="pre">You</span> <span class="pre">just</span> <span class="pre">added</span> <span class="pre">___</span></code>.</p></li>
<li><p>Instead of an unordered list, use a checkbox form to display the items. When
submitted, any items checked in the form will be removed from the list.</p>
<div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/checkbox-remove.png"><img alt="Checkbox form allowing users to remove multiple items at once." src="../../_images/checkbox-remove.png" style="width: 40%;" /></a>
<p class="caption"><span class="caption-text">This is MUCH easier than having to type in the items you want to remove!</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</li>
</ol>
<div class="admonition-tip admonition">
<p class="admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p>Checkout the <code class="docutils literal notranslate"><span class="pre">final-code</span></code> branch of the repository to examine one possible
solution for the checkbox form.</p>
<p>Also, the <code class="docutils literal notranslate"><span class="pre">buttons</span></code> branch in the repo shows one way to retrieve data from
a <code class="docutils literal notranslate"><span class="pre">&lt;button&gt;</span></code> element rather than an input box.</p>
</div>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="try-it-sessions.html"><span aria-hidden="true">&larr;</span> <span class="section-number">23.5. </span>Try It! Flask Sessions</a></li>
        
        
        <li class="next"><a href="exercises.html"><span class="section-number">23.7. </span>Exercises: Flask Sessions <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/sessions/try-it-part2.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>